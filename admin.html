<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© | Ø§Ù„Ù…ÙØµÙŠØ¨Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@700;900&display=swap" rel="stylesheet">
    <style>
        /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© */
        #admin-lock { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #05011a; display: flex; justify-content: center; align-items: center; z-index: 10000; flex-direction: column; }
        .login-box { background: rgba(255,255,255,0.05); padding: 40px; border-radius: 25px; text-align: center; border: 1px solid #00f2ea; width: 90%; max-width: 350px; }
        .login-box input { width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 12px; border: none; text-align: center; font-size: 18px; }
        .btn-enter { width: 100%; padding: 15px; border-radius: 12px; border: none; background: linear-gradient(45deg, #00f2ea, #667eea); color: white; font-weight: 900; cursor: pointer; }
        #admin-main { display: none; }
        body { font-family: 'Tajawal', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 25px; }
        .user-row { display: flex; align-items: center; justify-content: space-between; padding: 15px; background: #fafafa; border-radius: 12px; margin-bottom: 10px; border: 1px solid #eee; }
        .balance-badge { background: #e8f5e9; color: #2e7d32; padding: 8px 15px; border-radius: 10px; font-weight: 900; min-width: 50px; text-align: center; }
        .balance-input { width: 70px !important; padding: 8px; border: 1px solid #ddd; border-radius: 8px; text-align: center; }
        button { padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; color: white; font-weight: bold; transition: 0.3s; }
        .btn-add { background: #27ae60; } .btn-sub { background: #e74c3c; }
        button:hover { transform: scale(1.1); opacity: 0.9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #302b63; color: white; padding: 12px; text-align: right; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; }
        .status-msg { font-size: 12px; color: #666; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="admin-lock">
        <div class="login-box">
            <h2 style="color:white; margin-bottom: 20px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± ğŸ›¡ï¸</h2>
            <input type="text" id="admUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            <input type="password" id="admPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button class="btn-enter" onclick="validateAdmin()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="admin-main">
        <div class="card">
            <h3>ğŸ’° Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ù„ÙƒØ§Øª</h3>
            <div id="balances-container">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±...</div>
            <div id="last-update" class="status-msg"></div>
        </div>

        <div class="card">
            <h3>ğŸ“¦ Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±</h3>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr><th>Ø§Ù„Ø£Ù…ÙŠØ±Ø©</th><th>Ø§Ù„Ø®Ø¯Ù…Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø±Ø§Ø¨Ø·</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>
                    </thead>
                    <tbody id="list">
                        <tr><td colspan="5" style="text-align:center">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ ØªØ¨Ø¹Ùƒ ÙŠØ§ Ù‚ØµÙŠ
        const scriptURL = "https://script.google.com/macros/s/AKfycbwUT0hkoVkAAPo9TeWIOYoQVMJPtrWDnMNorramxeusX4UPHPlwREE7ti3zGsaHj7Lk/exec";
        
        function validateAdmin() {
            const user = document.getElementById('admUser').value;
            const pass = document.getElementById('admPass').value;
            if (user === "admin" && pass === "0598787757") {
                document.getElementById('admin-lock').style.display = 'none';
                document.getElementById('admin-main').style.display = 'block';
                loadData();
                setInterval(loadData, 30000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            } else {
                alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙ„Ø· ÙŠØ§ Ù…Ø¯ÙŠØ±!");
            }
        }

        async function loadData() {
            try {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø±ØµØ¯Ø© ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                const balRes = await fetch(scriptURL + "?action=getBalances").then(r => r.json()).catch(e => ({}));
                const ordRes = await fetch(scriptURL + "?action=getOrders").then(r => r.json()).catch(e => []);

                const balContainer = document.getElementById('balances-container');
                balContainer.innerHTML = "";
                
                // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù†Ø§Øª (ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯Ù‡Ù… ÙÙŠ Ø§Ù„Ø´ÙŠØª Ø¨Ù†ÙØ³ Ø§Ù„Ø³Ø¨ÙŠÙ„Ù†Ø¬)
                const users = ['Ù†Ø¬Ù„Ø§Ø¡', 'ÙˆØ±Ø¯Ù‡', 'Ù…Ø±Ø­'];

                users.forEach(u => {
                    let b = (balRes && balRes[u] !== undefined) ? balRes[u] : "0";
                    balContainer.innerHTML += `
                        <div class="user-row">
                            <b>ğŸ‘‘ ${u}</b>
                            <div class="balance-badge" id="val_${u}">$${b}</div>
                            <div>
                                <input type="number" id="amt_${u}" class="balance-input" placeholder="0">
                                <button class="btn-add" onclick="updateBal('${u}','add')">Ø¥Ø¶Ø§ÙØ©</button>
                                <button class="btn-sub" onclick="updateBal('${u}','sub')">Ø³Ø­Ø¨</button>
                            </div>
                        </div>`;
                });

                // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                const listBody = document.getElementById('list');
                if (ordRes && ordRes.length > 0) {
                    listBody.innerHTML = ordRes.reverse().slice(0, 20).map(o => `
                        <tr>
                            <td><b>${o.user}</b></td>
                            <td>${o.service}</td>
                            <td>${o.qty}</td>
                            <td><a href="${o.link}" target="_blank" style="color:#3498db">ÙØªØ­</a></td>
                            <td><small>${o.date}</small></td>
                        </tr>
                    `).join('');
                } else {
                    listBody.innerHTML = "<tr><td colspan='5' style='text-align:center'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</td></tr>";
