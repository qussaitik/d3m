<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© | Ø§Ù„Ù…ÙØµÙŠØ¨Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #05011a; color: white; margin: 0; padding: 20px; text-align: center; }
        #admin-lock { position: fixed; inset: 0; background: #05011a; display: flex; justify-content: center; align-items: center; z-index: 10000; }
        .login-box { background: #1a1c23; padding: 40px; border-radius: 20px; border: 2px solid #00f2ea; width: 300px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: none; text-align: center; font-size: 18px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #00f2ea; color: black; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; }
        #admin-main { display: none; max-width: 600px; margin: auto; }
        .card { background: #1f222b; padding: 20px; border-radius: 15px; margin-top: 20px; border: 1px solid #333; }
        .user-row { display: flex; justify-content: space-between; align-items: center; background: #2a2e38; padding: 15px; border-radius: 12px; margin-bottom: 10px; }
        .bal-val { color: #00f2ea; font-size: 22px; font-weight: 900; }
        .btn-act { width: auto; padding: 5px 15px; margin: 0 3px; font-size: 20px; }
    </style>
</head>
<body>

    <div id="admin-lock">
        <div class="login-box">
            <h2 style="color:white">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± ğŸ›¡ï¸</h2>
            <input type="password" id="p" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="admin-main">
        <div class="card">
            <h2 style="color: #00f2ea;">ğŸ‘‘ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ù„ÙƒØ§Øª</h2>
            <div id="list">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª... ğŸ”„</div>
        </div>
        
        <div class="card" style="font-size: 14px;">
            <h3>ğŸ“¦ Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
            <div id="orders-list">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</div>
        </div>
    </div>

    <script>
        // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø®ÙŠØ± Ø§Ù„Ù„ÙŠ Ø¨Ø¹ØªÙ„ÙŠ Ø§ÙŠØ§Ù‡ ÙŠØ§ Ù‚ØµÙŠ
        const url = "https://script.google.com/macros/s/AKfycbz33uo9f-5eVXAFaI6qfk5ce-mgSX-tQ0q7HjDlYFa4akBvn3NuaUh5fuqYYMc1FEA/exec";

        function login() {
            if (document.getElementById('p').value === "0598787757") {
                document.getElementById('admin-lock').style.display = 'none';
                document.getElementById('admin-main').style.display = 'block';
                loadData();
            } else { alert("Ø§Ù„Ø¨Ø§Ø³ÙˆÙˆØ±Ø¯ ØºÙ„Ø·!"); }
        }

        async function loadData() {
            const listDiv = document.getElementById('list');
            const ordersDiv = document.getElementById('orders-list');
            try {
                const [balRes, ordRes] = await Promise.all([
                    fetch(url + "?action=getBalances").then(r => r.json()),
                    fetch(url + "?action=getOrders").then(r => r.json())
                ]);

                // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±ØµØ¯Ø©
                listDiv.innerHTML = "";
                ['Ù†Ø¬Ù„Ø§Ø¡', 'ÙˆØ±Ø¯Ù‡', 'Ù…Ø±Ø­'].forEach(u => {
                    let b = balRes[u] || 0;
                    listDiv.innerHTML += `
                        <div class="user-row">
                            <span>ğŸ‘‘ ${u}</span>
                            <span class="bal-val" id="v_${u}">$${b}</span>
                            <div>
                                <input type="number" id="i_${u}" style="width:60px; padding:5px; margin:0" placeholder="0">
                                <button class="btn-act" style="background:green; color:white" onclick="update('${u}','add')">+</button>
                                <button class="btn-act" style="background:red; color:white" onclick="update('${u}','sub')">-</button>
                            </div>
                        </div>`;
                });

                // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                ordersDiv.innerHTML = ordRes.reverse().slice(0, 10).map(o => 
                    `<div style="border-bottom: 1px solid #333; padding: 8px; text-align: right;">
                        <b>${o.user}</b>: ${o.service} (${o.qty}) 
                    </div>`
                ).join('') || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯";

            } catch (e) {
                listDiv.innerHTML = "<p style='color:orange'>ÙÙŠ Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ù„Ø§ØªØµØ§Ù„.. Ø¬Ø±Ø¨ Ø­Ø¯Ø« Ø§Ù„ØµÙØ­Ø©</p>";
            }
        }

        async function update(u, t) {
            const val = document.getElementById('i_'+u).value;
            if(!val) return;
            document.getElementById('v_'+u).innerText = "â³";
            
            await fetch(url, {
                method: "POST",
                mode: "no-cors",
                body: JSON.stringify({ action: "updateBalance", user: u, amount: val, type: t })
            });
            
            setTimeout(loadData, 2000);
        }
    </script>
</body>
</html>
