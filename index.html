<script>
    // الرابط الجديد تبعك يا قصي
    const url = "https://script.google.com/macros/s/AKfycbyqXOusm9NTC-P75CzHfQlmM4wfbMTP5VNiw0lXjRhhhxG6uTITStHqdm44bkfX4VXB/exec";

    async function executeLogin() {
        const userField = document.getElementById('user').value.trim();
        const passField = document.getElementById('pass').value.trim();
        const btn = document.querySelector('button');

        if (!userField || !passField) {
            alert("يا غالي، عبّي الاسم وكلمة المرور!");
            return;
        }

        btn.innerText = "جاري التحقق...";
        btn.disabled = true;

        try {
            // طلب البيانات من الشيت (الأرصدة والباسوردات)
            const res = await fetch(url + "?action=getBalances");
            const allData = await res.json();

            // فحص هل الاسم موجود؟
            if (allData[userField]) {
                const correctPass = String(allData[userField].password);
                
                // مقارنة الباسورد المدخل مع اللي في العمود C
                if (passField === correctPass) {
                    localStorage.setItem('user', userField);
                    sessionStorage.setItem('currentUser', userField);
                    window.location.href = "services.html";
                } else {
                    alert("كلمة المرور غلط يا بطل!");
                    resetBtn();
                }
            } else {
                alert("هاد الاسم مش مسجل عندنا!");
                resetBtn();
            }
        } catch (e) {
            alert("مشكلة في الاتصال.. تأكد من نشر السكريبت كـ 'Anyone'");
            resetBtn();
        }
    }

    function resetBtn() {
        btn.innerText = "تسجيل الدخول";
        btn.disabled = false;
    }
</script>
